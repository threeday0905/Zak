/*! Zak.js 0.1.2
 * Author: Herman Lee <threeday0905@gmail.com>
 * Description: Phonegap framework, an easy way to build SPA on local side
 * Dependencies: jQuery, Handlebars.js
 * Date: 2013-07-18 */
!function(){"use strict";String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF]+|[\s\uFEFF]+$/g,"")}),Array.prototype.forEach||(Array.prototype.forEach=function(a,b){var c,d;for(c=0,d=this.length;d>c;++c)a.call(b,this[c],c,this)}),"function"!=typeof Array.isArray&&(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){if(null===this)throw new TypeError;var c,d=this.length,e=0;if(0===d)return-1;if(b&&(e=Number(b),isNaN(e)?e=0:0!==e&&1/0!==e&&e!==-1/0&&(e=(e>0||-1)*Math.floor(Math.abs(e)))),e>=d)return-1;for(c=e>=0?e:Math.max(d-Math.abs(e),0);d>c;c++)if(this[c]===a)return c;return-1}),Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e})}(window),function(a){"use strict";var b,c=a,d=a.document,e=a.location,f=a.console;b={is:{fn:function(a){return"function"==typeof a},arr:function(a){return Array.isArray(a)},bool:function(a){return"boolean"==typeof a||a&&a.constructor===Boolean},str:function(a){return"string"==typeof a||a&&a.constructor===String},num:function(a){return"number"==typeof a||a&&a.constructor===Number},obj:function(a){return"object"==typeof a},dom:function(a){return a&&a.nodeType&&1===a.nodeType},nodeList:function(a){return/^\[object (HTMLCollection|NodeList|Object)\]$/.test(Object.prototype.toString.call(a))&&(0===a.length||"object"==typeof a[0]&&a[0].nodeType>0)},empty:function(a){return void 0===a||null===a||(b.is.arr(a)||b.is.str(a)||b.is.nodeList(a))&&0===a.length}},to:{arr:function(a){var c;return c=b.is.empty(a)?[]:b.is.arr(a)||b.is.nodeList(a)?a:[a]},obj:function(a,c,d){if(!c||!b.is.arr(a)||!a.length)return{};var e,f,g,h,i,j={};if(b.is.empty(d)||b.is.str(d))for(h=d?d.match(/\S+/g):[],e=0,g=a.length;g>e;e++){if(0===h.length)i=a[e];else if(1===h.length)i=a[e][h[0]];else for(f=h.length;f--;)i[h[f]]=a[e][h[f]];a[e][c]?j[a[e][c]]=i:"self"===c&&(j[a[e]]=i)}else if(b.is.fn(d))for(e=0,g=a.length;g>e;e++)"self"===c?j[a[e]]=d.call(a[e],a[e]):a[e][c]&&(j[a[e][c]]=d.call(a[e],a[e][c]));return j},objByKey:function(a,c,d){var e,f;if(b.is.obj(a))f=a;else if(b.is.arr(c)&&d){for(e=c.legnth;e--;)if(c[e][d]===a){f=c[e][d];break}}else b.is.obj(c)&&(f=c[a]||void 0);return f},opt:function(a){return b.is.str(a)&&a?a.match(/\S+/g)||[]:b.to.arr(a)},split:function(a,c){if(b.is.empty(a))return[];for(var d=a.split(c),e=d.length;e--;)d[e]=d[e].trim();return d}},oo:{inherit:function(){var a=function(){};return function(b,c){a.property=c.prototype,b.property=new a,b.uber=c.prototype,b.prototype.constructor=b}}(),mixin:function(a){var c,d,e,f,g,h,i,j,k;if(j=a||{},arguments.legnth<=1)return j;for(c=1,d=arguments.length;d>c;c++)if(h=arguments[c])if(Object.keys)for(g=Object.keys(h),e=0,f=g.length;f>e;e++)i=g[e],b.is.obj(h[i])?((b.is.empty(j[i])||!b.is.obj(j[i]))&&(j[i]=b.is.arr(h[i])?[]:{}),b.oo.mixin(j[i],h[i])):(k=Object.getOwnPropertyDescriptor(h,i),b.is.obj(k)?Object.defineProperty(j,i,k):j[i]=k);else for(i in h)h.hasOwnProperty(i)&&(b.is.obj(h[i])?((b.is.empty(j[i])||!b.is.obj(j[i]))&&(j[i]=b.is.arr(h[i])?[]:{}),b.oo.mixin(j[i],h[i])):j[i]=h[i]);return j}},evt:{bind:function(c,d,e){return b.is.dom(c)&&d&&b.is.fn(e)?(c.addEventListener?c.addEventListener(d,e,!1):c.attachEvent&&c.attachEvent("on"+d,function(b){var c=this;b=b||a.event,b.preventDefault=b.preventDefault||function(){b.returnValue=!1},b.stopPropagation=b.stopPropagation||function(){b.cancelBubble=!0},e.call(c,b)}),void 0):!1},touch:function(a,c){return b.is.dom(a)&&b.is.fn(c)?(function(a,c){var d,e,f,g,h;h=function(b){return c.call(a,b),b.preventDefault(),!1},b.evt.bind(a,"touchstart",function(a){a.touches.length>0&&(d=a.touches[0].pageX,e=a.touches[0].pageY,f=a.timeStamp),g=!1}),b.evt.bind(a,"touchend",function(a){a.changedTouches.length>0&&Math.abs(a.changedTouches[0].pageX-d)<10&&Math.abs(a.changedTouches[0].pageY-e)<10&&a.timeStamp-f<250&&!g&&(h(a),g=!0)}),b.evt.bind(a,"click",function(a){g||(h(a),g=!1)})}(a,c),void 0):!1}},node:{parse:function(a,b){var c,e,f=[];for(b||(b=d.createElement("div")),a&&(b.innerHTML=a),c=0,e=b.childNodes.length;e>c;c++)1===b.childNodes[c].nodeType&&f.push(b.childNodes[c]);return f},append:function(a,c,e){var f,g;if(b.is.str(a)&&(a=d.getElementById(a)),b.is.dom(a)){if(c=b.to.arr(c),e)for(;a.firstChild;)a.removeChild(a.firstChild);for(f=0,g=c.length;g>f;f++)c[f]&&a.appendChild(c[f])}},after:function(a,c){var d,e;if(a)for(c=b.to.arr(c),d=0,e=c.length;e>d;d++)c[d]&&a.parentNode.insertBefore(c[d],a.nextSibling)}},storage:function(){var b,c,d,e,f=a.JSON;try{b=String((new Date).valueOf()),e=a.localStorage,e.setItem(b,b),e.getItem(b)===b?(e.removeItem(b),c=!0):c=!1}catch(g){c=!1}return c&&f?(d=function(a){var b,c,e=this;b=function(){d.setItem(a,c)},c=d.getItem(a)||{},e.available=!0,e.exists=function(a){return!!e.take(a)},e.take=function(a){return c[a.toString()]},e.put=function(a){c[a.toString()]=a.valueOf(),b()},e.remove=function(a){delete c[a.toString()],b()},e.clear=function(){c={},b()}},d.available=!0,d.setItem=function(a,b){e.setItem(a,f.stringify(b))},d.getItem=function(a){return f.parse(e.getItem(a)||"{}")}):(d=function(){this.available=!1},d.available=!1),d}(),dom:{clas:function(){function a(a,c){return b?function(b,c){c&&b.classList[a](c)}:function(a,b){if(b){var d=a.className.split(/\s+/),e=d.indexOf(b);c(d,e,b),a.classname=d.join(" ")}}}var b=void 0!==d.createElement("div").classList;return{add:a("add",function(a,b,c){-1===b&&a.push(c)}),remove:a("remove",function(a,b){b>-1&&a.splice(b,1)}),toggle:a("toggle",function(a,b,c){b>-1?a.splice(b,1):a.push(c)}),contains:function(a,c){return b?a.classList.contains(c):a.className.lastIndexOf(c)>-1}}}(),data:function(){function a(a){var b,c;return a||(a=""),c=a.replace(/^data-/,"").replace(/-(\w)?/g,function(a,b){return b?b.toUpperCase():""}),b=a.replace(/([a-z][A-Z])/g,function(a,b){return b.charAt(0)+"-"+b.charAt(1).toLowerCase()}),/^data-/.test(b)||(b="data-"+b),{propKey:b,dataKey:c}}var b=void 0!==d.createElement("div").dataset;return{take:function(b,c){var d=a(c);return b.getAttribute(d.propKey)},put:function(b,c,d){var e=a(c);return b.setAttribute(e.propKey,d)},dataSet:function(a){return b?a.dataSet:{}}}}()},ajax:function(a,c){var d;return $.support.cors=!0,$.ajax({async:!1,url:a,dataType:c.dataType}).done(function(a){d=a}).fail(function(){b.log(a,"AJAX Error")}),d},par:{qtr:function(a){var b,c;return b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(e.href),c?c[1]:""}},log:function(a,c){b.is.empty(f.log)||f.log((b.is.empty(c)?"":"["+c+"] ")+a)},err:function(a,c){var d=(b.is.empty(c)?"":"["+c+"]")+a;throw d},timer:function(){var a={startTime:void 0,during:0,start:function(){this.startTime=new Date},done:function(a,c){return this.endTime=new Date,this.during=this.endTime.valueOf()-this.startTime.valueOf(),a&&b.log(a.replace(/\{0\}/g,this.during),"Timer - "+c),this.during}};return a.start(),a}},c.swak=b}(window);var ajax=function(a,b,c){"use strict";var d,e,f,g,h,i,j,k;return d=a.replace(/#[\w\W]*$/,"").replace(/^\/\//,window.location.protocol+"//"),e=b||{},f=c||{},g=-1===d.lastIndexOf(window.location.protocol+"//"+window.location.host),h=function(){var a,b=window.XMLHttpRequest,c=window.XDomainRequest,d=window.ActiveXObject;if(b)a=new b;else if(c)j=!0,a=new c;else if(d)try{a=new d("Microsoft.XMLHTTP")}catch(e){}return a}(),i=function(a){var b,c=[];for(b in a)if(a.hasOwnProperty(b)&&a[b])switch(typeof a[b]){case"number":case"string":case"boolean":c.push(encodeURIComponent(b)+"="+encodeURIComponent(a[b]))}return c.join("&").replace(/%20/g,"+")}(e.data||{}),"POST"!==e.type&&(e.type="GET"),(g||e.dataToURL)&&i&&(d+=(/\?/.test(a)?"&":"?")+i),e.cache!==!0&&(d+=(/\?/.test(a)?"&":"?")+(new Date).getTime()),j||(h.setRequestHeader("Accept","*/*"),"POST"===e.type&&h.setRequestHeader("Content-Type","application/x-www-form-urlencoded")),h.open(e.type,d,!1),h.send(i),j?(h.ontimeout=h.onerror=function(){k=!1},h.onload=function(){k=h.responseText}):(h.onreadystatechange=function(){k=4===h.readyState&&200===h.status?h.responseText:!1},h.onreadystatechange()),k};!function(a){"use strict";var b,c=a,d=a.document,e=a.swak;b=function(b){b=b||{};var c,f,g;c=e.oo.mixin({update:"data-zak-txt",show:"data-zak-show",clas:"data-zak-class"},b.dataKey),f={normal:/\$\{([#\w\.\?\= ]+)\}/,keys:/\$\{([#\w\.\?\= ]+)\}/g,condition:/#if +([\w\.]+) *= *(\w+) *\? *(\w+) *:? *(\w*)/,pure:/^[\w,]+$/},g={},g.pattern={check:function(a){return f.normal.test(a)}},g.source={unwrap:function(a){var b=f.normal.exec(a||"");return b?b[1]:""},pure:function(a,b){var c=g.source.path(a);return g.source.extract(c,b)},path:function(a){return e.to.split(a,".")},extract:function(a,b){if(e.is.empty(a)||!b)return void 0;var c=b[a.shift()];return a.length?this.extract(a,c):c},condition:function(a,b){var c,d,e,h,i,j=f.condition.exec(a);return c=j[1],d=j[2],e=g.source.value(c,b).toString()===d,h=e?j[3]:j[4],i=e?j[4]:j[3],{condition:!0,result:e,pass:h,fail:i}},value:function(a,b){if(!e.is.str(a))return"";var c=g.pattern.check(a)?g.source.unwrap(a):a,d="";return"#"===c[0]?f.condition.test(c)&&(d=g.source.condition(c,b)):d=g.source.pure(c,b),d}},g.dom={prop:{text:function(){return"innerText"in d.createElement("div")?"innerText":"textContent"}(),html:"innerHTML"},take:{keyCache:function(a){return a.keyCache||(a.keyCache={attr:{}}),a.keyCache},selector:function(a,b,c){var d="",f=g.dom.take.keyCache(a);return"text"===b?(d=f.text||a[g.dom.prop.text],f.text=d):"attr"===b&&e.is.str(c)&&(d=f.attr[c]||a.getAttribute(c),f.attr[c]=d),d},datakey:function(a,b){return e.dom.data.take(a,b)}},update:{text:function(a,b){var c=g.dom.take.selector(a,"text"),d=g.source.value(c,b);a[g.dom.prop.text]=d},attr:function(a,b,c){var d=g.dom.take.selector(a,"attr",b),e=g.source.value(d,c);a.setAttribute(b,e)}},trigger:function(a,b,d){if(!e.is.empty(a)&&g.dom.method[b]){a=e.to.arr(a);for(var f,h=a.length;h--;)f=g.dom.take.datakey(a[h],c[b]),g.dom.method[b](a[h],f,d)}},method:{update:function(a,b,c){for(var d,f=e.to.split(b,","),h=f.length;h--;)d=f[h],"@"===d.charAt(0)?g.dom.update.attr(a,d.substr(1),c):"text"===d&&g.dom.update.text(a,c)},show:function(a,b,c){var d=g.source.value(b,c),e=g.dom.take.keyCache(a);d?a.style.display=e.display||"block":"none"!==a.style.display&&(e.display=a.style.display,a.style.display="none")},clas:function(a,b,c){var d=g.source.value(b,c);d&&(d.condition?(d.pass&&e.dom.clas.add(a,d.pass),d.fail&&e.dom.clas.remove(a,d.fail)):d&&e.dom.clas.add(a,d))}}},this.tmpl={collect:function(a){if(!e.is.str(a))return[];var b,c=[],d=f.keys;for(d.lastIndex=0;null!==(b=d.exec(a));)c.push(b[1]);return c},extend:function(a,b){return e.is.str(a)?e.is.empty(b)?a:a.replace(f.keys,function(a,c){return b[c]||a}):""}},this.html={chew:function(b,c){if(!a.Handlebars||e.is.empty(b))return b;var d=a.Handlebars.compile(b);return d?d(c||{}):b}},this.dom={chew:function(a,b){a=e.to.arr(a);for(var d,f=a.length;f--;)for(d in c)c.hasOwnProperty(d)&&g.dom.trigger(a[f].querySelectorAll("["+c[d]+"]"),d,b)}},this.data={chew:function(a,b){return g.source.value(a,b)}},this.isPattern=g.pattern.check},c.Kaz=b}(window),function(window){"use strict";var exports=window,document=window.document,navigator=window.navigator,location=window.location,userAgent=navigator.userAgent,setTimeout=window.setTimeout,href=location.href,Zak,ZakHelper,AppItem,Page,Element,Script,Source,Material,Template,Node,kaz,swak,flag,config;swak=window.swak,kaz=new window.Kaz,flag={phonegap:/^file:\//i.test(href)&&/ios|iphone|ipod|ipad|android/i.test(userAgent),ios:/ios|iphone|ipod|ipad/i.test(userAgent),android:/android/i.test(userAgent)},config={appName:"Zak App",scriptMethods:["init","load","render","show","hide","source"],dataKey:{mtrFilter:"data-page-filter",mtrParameter:"data-page-parameter",btnSwitch:"data-btn-switch",btnRefresh:"data-btn-refresh",btnBack:"data-btn-back",btnExtenal:"data-btn-external"},sourceType:[{name:"template",dataType:"html"},{name:"element",dataType:"html"},{name:"script",dataType:"script"},{name:"material",dataType:"json"}],sourcePath:{element:"./resource/element/${0}.html",template:"./resource/template/${0}.html",material:"./resource/material/${0}.json",script:"./resource/script/${0}.js"},storageKey:"zak_Source",material:{filterKey:"one",parameterKey:"par"},cache:!0,prod:!1},Source=function(options){var SourceItem,setting=swak.oo.mixin({},{storageKey:config.storageKey,sourceType:config.sourceType,sourcePath:config.sourcePath,sourceProxy:{}},options),cache=new swak.storage(setting.storageKey+(setting.id?"_"+setting.id:"")),remote=function(a){return swak.ajax(a.path(),{dataType:a.dataType})},memCache={},proxy=setting.sourceProxy,path=setting.sourcePath,types=swak.to.obj(setting.sourceType,"name"),timer=new swak.timer;SourceItem=function(type,key,options2){if(!type||!key)return void 0;var setting2=swak.oo.mixin({refresh:!1},options2),typeObj=swak.to.objByKey(type,types),reload=setting2.refresh||this.needRefresh();this.type=typeObj.name,this.dataType=typeObj.dataType,this.key=key,this.value=void 0,this.cache=!0,this.error=!1,setting.debug&&timer.start(),cache.available?reload||!cache.exists(this)?(this.value=remote(this),this.cache=!1,cache.put(this),memCache[this.toString()]=this.value):memCache[this.toString()]?this.value=memCache[this.toString()]:(this.value=cache.take(this),memCache[this.toString()]=this.value):reload||swak.is.empty(memCache[this.toString()])?(this.value=remote(this),this.cache=!1,memCache[this.toString()]=this.value):(this.value=memCache[this.toString()],this.cache=!0),this.cache&&typeObj===types.script&&eval(this.value),setting.debug&&timer.done(this.path()+" loaded {0} / "+(this.cache?"(cache)":"(remote)"),"Source - "+this.type)},SourceItem.prototype={toString:function(){return this.key+"_"+this.type},valueOf:function(){return this.value},path:function(){var a=this,b=function(){return(path[a.type]||"").replace(/\$\{(\w)\}/g,function(b,c){switch(c){case"0":return a.key;case"1":return a.type;case"2":return a.dataType;default:return b}})};return swak.is.fn(proxy.path)?proxy.path.call(a,b):b()},needRefresh:function(){var a=this,b=function(){return!1};return swak.is.fn(proxy.needRefresh)?proxy.needRefresh.call(a,b):b()}},this.sync=function(a,b,c){var d=new SourceItem(a,b,swak.is.bool(c)?{refresh:c}:c);return d.value},this.clear=function(){cache&&cache.clear&&cache.clear(),memCache={}},this.path=path},Material=function(a,b,c){var d,e,f,g,h=swak.oo.mixin({filterName:config.material.filterKey,parameterName:config.material.parameterKey},c);this.load=function(a,c){if(g={},a&&(f=swak.to.opt(a)),!swak.is.empty(f))for(var d,e=f.length,i=!(!c&&!h.refresh);e--;)d=f[e].replace(/\.[\w\W]*/,""),d&&(g[d]=b.sync("material",d,i))},this.parameter=function(a){a!==!0||swak.is.empty(e)||(a=e),swak.is.obj(a)&&a.items?(e=a,g[h.parameterName]=a.items):g[h.parameterName]&&(e=null,delete g[h.parameterName])},this.filter=function(a){a!==!0||swak.is.empty(d)||(a=d),swak.is.obj(a)?(d=a,g[h.filterName]={},a=swak.to.arr(a).forEach(function(a){swak.is.fn(a.reduce)&&(g[h.filterName][a.dataName]=a.reduce(g))})):g[h.filterName]&&(d=null,delete g[h.filterName])},this.data=function(a,b){return(a||a===!1)&&this.filter(a),(b||b===!1)&&this.parameter(b),g},this.reset=function(){return this.filter(!1),this.parameter(!1),g},a&&this.load(a)},Material.Filter=function(a,b,c){this.isFilter=!0,this.dataName=a,this.prop=b,this.value=c||"",this.reduce=function(a,b){a||(a={}),b&&(this.value=b||"");var c,d=this.dataName?a[this.dataName]:a;if(swak.is.arr(d))for(c=d.length;c--;)if(d[c][this.prop].toString()===this.value.toString())return d[c]}},Material.Filter.create=function(a,b,c){if(swak.is.empty(a))return void 0;var d,e,f=[];if(3===arguments.length)f.push(new Material.Filter(a,b,c));else if(a)for(d=/\s*(\w+):(\w+):(\w+)\s*/g;null!==(e=d.exec(a));)f.push(new Material.Filter(e[1],e[2],e[3]));return f.isFilter=!0,f},Material.Parameter=function(a){var b,c=this,d=/(\w+)\s*:\s*([\w\.]*)/g;if(c.items={},swak.is.str(a)&&a)for(;null!==(b=d.exec(a));)c.items[b[1]]="undefined"===b[2]||"null"===b[2]?null:b[2];c.isParameter=!0},Material.Parameter.create=function(a){return swak.is.empty(a)?void 0:new Material.Parameter(a)},Element=function(a,b,c){swak.is.bool(c)&&(c={refresh:c});var d=c||{};this.key=a,this.html=b.sync("element",a,d.refresh)},Script=function(a,b,c){this.source=b,this.setting=swak.oo.mixin({args:function(){return void 0}},c),this.queue=[],a&&this.load(a)},Script.prototype={load:function(a,b){var c=!(!b&&!this.setting.refresh),d=this.source;a&&swak.to.opt(a).forEach(function(a){d.sync("script",a,c)})},register:function(a,b){if(a){for(var c,d={},e=Script.methods.length;e--;)c=Script.methods[e],swak.is.fn(a[c])&&(d[c]=a[c]);d.extend=a.extend||{},d.id=b||+new Date,this.queue.push(d)}},exec:function(a,b){if(a){var c=b||this.setting.args();this.queue.forEach(function(b){swak.is.fn(b[a])&&b[a].apply(b,c)})}},clear:function(){this.queue=[]}},Script.methods=config.scriptMethods,Template=function(a,b,c){var d=c||{};this.template="",this.elements=void 0,this.tokens=void 0,this.load=function(a,c){var e=!(!c&&!d.refresh);this.key=a,a&&(this.template=b.sync("template",a,e),this.tokens=kaz.tmpl.collect(this.template),this.elements=swak.to.obj(this.tokens,"self",function(){return"#"!==this.charAt(0)?new Element(this,b,e).html:this}))},this.html=function(a){var b=kaz.tmpl.extend(this.template,this.elements);return kaz.html.chew(b,a)},this.sample=function(){return kaz.tmpl.extend(this.template,this.elements)},a&&this.load(a)},Page=function(a,b,c){var d=this,e=swak.oo.mixin({refreshBtn:!0,backBtn:!0},c);this.key=a,this.setting=e,this.cache={},this.node=new Node,this.material=new Material("",b,e),this.template=new Template("",b,e),this.script=new Script("",b,{args:function(){var a=d.data();return[d,a.data]}}),this.script.exec("init")},Page.prototype={show:function(){this.script.exec("show")},hide:function(){this.script.exec("hide")},load:function(a){a&&(this.cache={}),this.template.load(this.setting.template||this.key,a),this.material.load(this.setting.material,a),this.script.clear(),this.script.load(this.setting.script,a),this.script.register(this.setting.appScript),this.script.exec("load")},render:function(a){if(this.node.isEmpty()||a){var b=this.material.data();this.script.exec("source"),this.node.load(this.template.html(b)),this.script.exec("render")}return this.node.content()},reload:function(){this.load(!0),this.material.filter(!0),this.material.parameter(!0),this.render(!0)},filter:function(a){(a||a===!1)&&(this.material.filter(a),this.render(!0))},parameter:function(a){(a||a===!1)&&(this.material.parameter(a),this.render(!0))},content:function(){return this.node.content()},find:function(a){return this.node.find(a)},findAll:function(a){return this.node.findAll(a)},title:function(){var a=this.setting.title;return kaz.isPattern(a)?kaz.data.chew(a,this.material.data())||"":a},data:function(){return{data:this.material.data(),opt:{title:this.title(),nav:this.setting.nav||this.key,refreshBtn:!!this.setting.refreshBtn,backBtn:!!this.setting.backBtn}}},registerScript:function(a){this.script.register(a)}},Node=function(a){this.child=[],this.kazItem=[],a&&this.load()},Node.prototype={load:function(a){this.child=[],this.kazItem=[],this.add(a)},add:function(a,b){if(swak.is.str(a)){var c,d,e,f=document.createElement("div");for(f.innerHTML=a||"",c=0,d=f.childNodes.length;d>c;c++)e=f.childNodes[c],1===e.nodeType&&(this.child.push(e),b!==!0&&this.kazItem.push(e))}else swak.is.dom(a)&&(this.child.push(a),b!==!0&&this.kazItem.push(a))},content:function(){return this.child},isEmpty:function(){return!this.child||0===this.child.length},find:function(a){if(!a)return void 0;var b,c,d;for(c=0,d=this.child.length;d>c&&!(b=this.child[c].querySelector(a));c++);return b},findAll:function(a){if(!a)return[];var b,c,d=[];for(b=0,c=this.child.length;c>b;b++)d=d.concat(this.child[b].querySelectorAll(a));return d},update:function(a){kaz.dom.chew(this.kazItem,a)}},AppItem=function(a,b,c,d){var e,f,g=this,h=swak.oo.mixin({},d);e=new Node,f=new Template(b,c),this.type=a,"container"===a?(this.container=document.createElement("div"),f.tokens.forEach(function(a){"#"!==a.charAt(0)?e.add(f.elements[a]):"#page"===a&&e.add(g.container,!0)}),this.update=function(a){var b=a.data();e.update(b),swak.node.append(this.container,a.render(),!0)}):"mask"===a?(e.load(f.html()),this.update=function(a,b){function c(a){swak.is.dom(a)&&swak.dom.clas[f](a,b)}if(b){var d,f="show"===a?"add":"remove";h.containerId&&(d=document.getElementById(h.containerId),c(d)),e.content().forEach(c),"show"===a&&setTimeout(function(){g.update("hide",b)},4e3)}}):(e.load(f.html()),this.update=e.update),this.appendTo=function(a){swak.node.append(a,e.content())},h.containerId&&this.appendTo(h.containerId),swak.is.fn(h.render)&&h.render(e.content())},ZakHelper=function(a,b){function c(b){var c=b.querySelectorAll("["+g.btnSwitch+"]"),d=b.querySelectorAll("["+g.btnRefresh+"]"),e=b.querySelectorAll("["+g.btnBack+"]");f.call(c,function(b){var c=b.getAttribute(g.btnSwitch);c&&!swak.dom.data.take(b,"btnEvtBinded")&&(swak.evt.touch(b,function(){a.switchTo({key:c,filter:b.getAttribute(g.mtrFilter),parameter:b.getAttribute(g.mtrParameter)})}),swak.dom.data.put(b,"btnEvtBinded",!0))}),f.call(d,function(b){swak.dom.data.take(b,"btnBinded")||(swak.evt.touch(b,function(){a.refreshTo()}),swak.dom.data.put(b,"btnEvtBinded",!0))}),f.call(e,function(b){swak.dom.data.take(b,"btnBinded")||(swak.evt.touch(b,function(){a.backTo()}),swak.dom.data.put(b,"btnEvtBinded",!0))})}function d(a){var b,c=a.querySelectorAll("[target=_blank]"),d=/^https?:\/\//;f.call(c,function(a){swak.dom.data.take(a,"extLinkBinded")||(b=a.getAttribute("href"),d.test(b)&&swak.evt.touch(a,function(a){window.open(b,"_system"),a.preventDefault()}),swak.dom.data.put(a,"extLinkBinded",!0))})}function e(a){var b,c=a.querySelectorAll("["+g.btnExtenal+"]"),d=/^https?:\/\//;f.call(c,function(a){swak.dom.data.take(a,"extLinkBinded")||(b=a.getAttribute(g.btnExtenal),d.test(b)&&swak.evt.touch(a,function(a){window.open(b,flag.phonegap?"_system":"_blank"),a.preventDefault()}),swak.dom.data.put(a,"extLinkBinded",!0))})}var f=Array.prototype.forEach,g=b.dataKey||config.dataKey;return{pageSwitched:function(a){var b=a.pageCurrent.title();document.title&&(document.title=a.setting.appName+(b?" - ":"")+b),void 0!==location.hash&&(location.hash=a.pageCurrent.key),swak.is.fn(window.scrollTo)&&window.scrollTo(0,1)},clipApp:function(){var a,b=document.body;flag.phonegap&&!swak.dom.data.take(b,"fixHover")&&(swak.evt.bind(b,"touchstart",function(){}),swak.dom.data.take(b,"fixHover",!0));for(a in flag)flag.hasOwnProperty(a)&&flag[a]===!0&&swak.dom.clas.add(b,a)},clipElement:function(a){for(var b=swak.to.arr(a),f=b.length;f--;)c(b[f]),e(b[f]),flag.phonegap&&d(b[f])}}},Zak=function(a,b){Zak.instances.push(this);var c=this,d=swak.oo.mixin({containerId:a},config,b),e=new Source(d),f=new ZakHelper(this,d),g={containerId:d.containerId,render:f.clipElement};this.id=b.id||"",this.setting=d,this.helper=f,this.source=e,this.cache={},this.container=new AppItem("container",d.structure,e,g),d.mask&&(this.mask=new AppItem("mask",d.mask.element,e,g)),this.pages={},this.pageOpts=swak.to.obj(d.pages,"key"),this.pageHistoury=[],this.pageCurrent=void 0,this.pageLast=void 0,this.sync=c.source.sync,this.helper.clipApp(),d.indexPage?c.switchTo(d.indexPage):d.pages.length&&c.switchTo(d.pages[0].key)},Zak.prototype={getPageOpt:function(a,b){this.pageOpts[a]||(this.pageOpts[a]={}),b&&(this.pageOpts[a]=swak.oo.mixin(this.pageOpts[a],b));var c=this.pageOpts[a],d=this.helper;return c.appScript={render:function(a){d.clipElement(a.content())}},c},loadPage:function(a){return this.pages[a]=new Page(a,this.source,this.getPageOpt(a)),this.pages[a].load(),this.pages[a]},getPage:function(a){return this.pages[a]||this.loadPage(a)},switchTo:function(){function a(){var a,b={};return swak.is.str(arguments[0])||arguments[0]instanceof Page?(b.pageItem=arguments[0]||"",b.data=arguments[1]||void 0,b.reload=!!arguments[2]):swak.is.obj(arguments[0])&&(a=arguments[0],b.pageItem=a.key,b.data=void 0,swak.is.obj(b.data)?b.data=b.data:(a.filter||a.parameter)&&(b.data={},a.filter&&(b.data.filter=swak.is.str(a.filter)?Material.Filter.create(a.filter):a.filter),a.parameter&&(b.data.parameter=swak.is.str(a.parameter)?Material.Parameter.create(a.parameter):a.parameter)),b.reload=!(!a.reload&&!a.refresh)),b}function b(a){var b=swak.is.str(a.pageItem)?a.pageItem:a.pageItem.key,d=c.getPage(b),e=!1;return d?(a.reload&&d.reload(!0),e=a.reload||c.pageCurrent===d,e||(c.pageLast=c.pageCurrent,c.pageCurrent=d),a.data&&(d.filter(a.data.isFilter?a.data:a.data.filter),d.parameter(a.data.isParameter?a.data:a.data.parameter)),c.container.update(d),c.pageCurrent.show(),e||(c.pageLast&&c.pageLast!==c.pageCurrent&&c.pageLast.hide(),c.pageHistoury.push(c.pageCurrent.key)),c.helper.pageSwitched(c),void 0):!1}var c=this,d=a.apply(c,arguments);this.mask&&this.setting.mask.className?(this.mask.update("show",this.setting.mask.className),setTimeout(function(){b(d),c.mask.update("hide",c.setting.mask.className)},50)):b(d)},backTo:function(){this.pageLast&&this.switchTo(this.pageLast,void 0,!1)},refreshTo:function(){this.pageCurrent&&this.switchTo(this.pageCurrent,void 0,!0)},registerScript:function(a,b){var c=this.getPage(a);c&&c.registerScript(b)}},Zak.flag=flag,Zak.instances=[],Zak.createFilter=function(){return Material.Filter.create.apply(void 0,arguments)},Zak.createParameter=function(){return Material.Parameter.create.apply(void 0,arguments)},Zak.clearAll=function(){Zak.instances.forEach(function(a){a.source.clear(),a.pages=[]}),swak.storage.clear()},Zak.registerScript=function(a,b,c){var d,e,f;2===arguments.length?(d=Zak.instances[0],e=a,f=b):3===arguments&&(Zak.instances.forEach(function(b){(b.id===a||b===a)&&(d=b)}),e=b,f=c),d&&d.registerScript(e,f)},Zak.sync=function(a,b,c,d){var e,f,g,h;return 2===arguments.length||swak.is.obj(c)||swak.is.bool(c)?(e=Zak.instances[0],f=a,g=b,h=c):(3===arguments||swak.is.obj(d)||swak.is.bool(d))&&(Zak.instances.forEach(function(b){(b.id===a||b===a)&&(e=b)}),f=b,g=c,h=d),e?e.source.sync(f,g,h):""},exports.Zak=Zak}(window);
/*
//@ sourceMappingURL=dest/zak-source.js
*/